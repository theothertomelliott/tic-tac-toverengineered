FROM ../../+source

build:
    RUN --mount=type=cache,target=/root/.cache/go-build \
        go build -v -o app ./cmd/currentturn
    SAVE ARTIFACT app app

docker:
    FROM alpine
    WORKDIR /root
    COPY +build/app .
    ENTRYPOINT ["./app"]
    ARG VERSION=dev
    ARG IMAGE_REF=api-image:$VERSION
    RUN echo "Building image with tag $IMAGE_REF"
    SAVE IMAGE $IMAGE_REF