FROM ../../+source

build:
    RUN --mount=type=cache,target=/root/.cache/go-build \
        go build -v -o app ./cmd/web
    SAVE ARTIFACT app app

docker:
    FROM alpine
    WORKDIR /root
    COPY +build/app .
    ENTRYPOINT ["./app"]
    ARG VERSION=dev
    RUN echo "Building image for version $VERSION"
    SAVE IMAGE web-image:$VERSION